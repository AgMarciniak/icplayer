(function(){var a,b,c,f,g,h,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S=function(U,V){return function(){return U.apply(V,arguments)}},T=[].slice;a=jQuery,O=0,P=1,Q=2,F=13,L=9,C=46,B=8,H=37,K=39,M=38,D=40,G=36,E=35,J=33,I=34,o="jqconsole-",g=o+"cursor",h=o+"header",p=o+"prompt",q=p+"-text",n=o+"old-prompt",l=o+"input",m=o+"old-input",f=o+"blurred",z="keypress",w="<span/>",u="<div/>",v=":empty",N="\n",t=">>> ",s="... ",r=2,c=o+"ansi-",x="\x1B",y=/\[(\d*)(?:;(\d*))*m/,b=function(){function U(){this.stylize=S(this.stylize,this),this._closeSpan=S(this._closeSpan,this),this._openSpan=S(this._openSpan,this),this.getClasses=S(this.getClasses,this),this._style=S(this._style,this),this._color=S(this._color,this),this._remove=S(this._remove,this),this._append=S(this._append,this),this.klasses=[]}return U.prototype.COLORS=["black","red","green","yellow","blue","magenta","cyan","white"],U.prototype._append=function(V){if(V=""+c+V,-1===this.klasses.indexOf(V))return this.klasses.push(V)},U.prototype._remove=function(){var V,W,X,Y,Z,aa;for(Y=1<=arguments.length?T.call(arguments,0):[],aa=[],(W=0,Z=Y.length);W<Z;W++)X=Y[W],"fonts"===X||"color"===X||"background-color"===X?aa.push(this.klasses=function(){var ba,ca,da,ea;for(da=this.klasses,ea=[],(ba=0,ca=da.length);ba<ca;ba++)V=da[ba],V.indexOf(X)!==c.length&&ea.push(V);return ea}.call(this)):(X=""+c+X,aa.push(this.klasses=function(){var ba,ca,da,ea;for(da=this.klasses,ea=[],(ba=0,ca=da.length);ba<ca;ba++)V=da[ba],V!==X&&ea.push(V);return ea}.call(this)));return aa},U.prototype._color=function(V){return this.COLORS[V]},U.prototype._style=function(V){if(""===V&&(V=0),V=parseInt(V),!isNaN(V))return 0===V?this.klasses=[]:1===V?this._append("bold"):2===V?this._append("lighter"):3===V?this._append("italic"):4===V?this._append("underline"):5===V?this._append("blink"):6===V?this._append("blink-rapid"):8===V?this._append("hidden"):9===V?this._append("line-through"):10===V?this._remove("fonts"):11===V||12===V||13===V||14===V||15===V||16===V||17===V||18===V||19===V?(this._remove("fonts"),this._append("fonts-"+(V-10))):20===V?this._append("fraktur"):21===V?this._remove("bold","lighter"):22===V?this._remove("bold","lighter"):23===V?this._remove("italic","fraktur"):24===V?this._remove("underline"):25===V?this._remove("blink","blink-rapid"):28===V?this._remove("hidden"):29===V?this._remove("line-through"):30===V||31===V||32===V||33===V||34===V||35===V||36===V||37===V?(this._remove("color"),this._append("color-"+this._color(V-30))):39===V?this._remove("color"):40===V||41===V||42===V||43===V||44===V||45===V||46===V||47===V?(this._remove("background-color"),this._append("background-color-"+this._color(V-40))):49===V?this._remove("background-color"):51===V?this._append("framed"):53===V?this._append("overline"):54===V?this._remove("framed"):55===V?this._remove("overline"):void 0},U.prototype.getClasses=function(){return this.klasses.join(" ")},U.prototype._openSpan=function(V){return"<span class=\""+this.getClasses()+"\">"+V},U.prototype._closeSpan=function(V){return V+"</span>"},U.prototype.stylize=function(V){var W,X,Y,Z,aa,ba;for(V=this._openSpan(V),Y=0;(Y=V.indexOf(x,Y))&&-1!==Y;)if(X=V.slice(Y).match(y)){for(ba=X.slice(1),Z=0,aa=ba.length;Z<aa;Z++)W=ba[Z],this._style(W);V=this._closeSpan(V.slice(0,Y))+this._openSpan(V.slice(Y+1+X[0].length))}else Y++;return this._closeSpan(V)},U}(),R=function(U,V){return"<span class=\""+U+"\">"+(V||"")+"</span>"},A=function(){function U(V,W,X,Y,Z){null==Z&&(Z=!1),this._HideComposition=S(this._HideComposition,this),this._ShowComposition=S(this._ShowComposition,this),this._UpdateComposition=S(this._UpdateComposition,this),this._EndComposition=S(this._EndComposition,this),this._StartComposition=S(this._StartComposition,this),this._CheckComposition=S(this._CheckComposition,this),this._ProcessMatch=S(this._ProcessMatch,this),this._HandleKey=S(this._HandleKey,this),this._HandleChar=S(this._HandleChar,this),this.isMobile=!!navigator.userAgent.match(/iPhone|iPad|iPod|Android/i),this.isIos=!!navigator.userAgent.match(/iPhone|iPad|iPod/i),this.isAndroid=!!navigator.userAgent.match(/Android/i),this.auto_focus=!Z,this.$window=a(window),this.header=W||"",this.prompt_label_main="string"==typeof X?X:t,this.prompt_label_continue=Y||s,this.indent_width=r,this.state=P,this.input_queue=[],this.input_callback=null,this.multiline_callback=null,this.history=[],this.history_index=0,this.history_new="",this.history_active=!1,this.shortcuts={},this.$container=a("<div/>").appendTo(V),this.$container.css({top:0,left:0,right:0,bottom:0,position:"absolute",overflow:"auto"}),this.$console=a("<pre class=\"jqconsole\"/>").appendTo(this.$container),this.$console.css({margin:0,position:"relative","min-height":"100%","box-sizing":"border-box","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box"}),this.$console_focused=!0,this.$input_container=a(u).appendTo(this.$container),this.$input_container.css({position:"absolute",width:1,height:0,overflow:"hidden"}),this.$input_source=this.isAndroid?a("<input/>"):a("<textarea/>"),this.$input_source.attr({wrap:"off",autocapitalize:"off",autocorrect:"off",spellcheck:"false",autocomplete:"off"}),this.$input_source.css({position:"absolute",width:2}),this.$input_source.appendTo(this.$input_container),this.$composition=a(u),this.$composition.addClass(o+"composition"),this.$composition.css({display:"inline",position:"relative"}),this.matchings={openings:{},closings:{},clss:[]},this.ansi=new b,this._InitPrompt(),this._SetupEvents(),this.Write(this.header,h),a(V).data("jqconsole",this)}return U.prototype.ResetHistory=function(){return this.SetHistory([])},U.prototype.ResetShortcuts=function(){return this.shortcuts={}},U.prototype.ResetMatchings=function(){return this.matchings={openings:{},closings:{},clss:[]}},U.prototype.Reset=function(){return this.state!==P&&this.ClearPromptText(!0),this.state=P,this.input_queue=[],this.input_callback=null,this.multiline_callback=null,this.custom_control_key_handler=null,this.custom_keypress_handler=null,this.ResetHistory(),this.ResetShortcuts(),this.ResetMatchings(),this.$prompt.detach(),this.$input_container.detach(),this.$console.html(""),this.$prompt.appendTo(this.$console),this.$input_container.appendTo(this.$container),this.Write(this.header,h),void 0},U.prototype.GetHistory=function(){return this.history},U.prototype.SetHistory=function(V){return this.history=V.slice(),this.history_index=this.history.length},U.prototype._CheckKeyCode=function(V){if(V=isNaN(V)?V.charCodeAt(0):parseInt(V,10),!(0<V&&256>V)||isNaN(V))throw new Error("Key code must be a number between 0 and 256 exclusive.");return V},U.prototype._LetterCaseHelper=function(V,W){if(W(V),65<=V&&90>=V&&W(V+32),97<=V&&122>=V)return W(V-32)},U.prototype.RegisterShortcut=function(V,W){var X;if(V=this._CheckKeyCode(V),"function"!=typeof W)throw new Error("Callback must be a function, not "+W+".");return X=function(Y){return function(Z){return Z in Y.shortcuts||(Y.shortcuts[Z]=[]),Y.shortcuts[Z].push(W)}}(this),this._LetterCaseHelper(V,X),void 0},U.prototype.UnRegisterShortcut=function(V,W){var X;return V=this._CheckKeyCode(V),X=function(Y){return function(Z){if(Z in Y.shortcuts)return W?Y.shortcuts[Z].splice(Y.shortcuts[Z].indexOf(W),1):delete Y.shortcuts[Z]}}(this),this._LetterCaseHelper(V,X),void 0},U.prototype.GetColumn=function(){var V;return this.$prompt_right.detach(),this.$prompt_cursor.text(""),V=this.$console.text().split(N),this.$prompt_cursor.html("&nbsp;"),this.$prompt_cursor.after(this.$prompt_right),V[V.length-1].length},U.prototype.GetLine=function(){return this.$console.text().split(N).length-1},U.prototype.ClearPromptText=function(V){if(this.state===P)throw new Error("ClearPromptText() is not allowed in output state.");return this.$prompt_before.html(""),this.$prompt_after.html(""),this.$prompt_label.text(V?"":this._SelectPromptLabel(!1)),this.$prompt_left.text(""),this.$prompt_right.text(""),void 0},U.prototype.GetPromptText=function(V){var W,X,Y,Z,aa;if(this.state===P)throw new Error("GetPromptText() is not allowed in output state.");return V?(this.$prompt_cursor.text(""),aa=this.$prompt.text(),this.$prompt_cursor.html("&nbsp;"),aa):(Z=function(ba){var ca;return ca=[],ba.children().each(function(){return ca.push(a(this).children().last().text())}),ca.join(N)},X=Z(this.$prompt_before),X&&(X+=N),Y=this.$prompt_left.text()+this.$prompt_right.text(),W=Z(this.$prompt_after),W&&(W=N+W),X+Y+W)},U.prototype.SetPromptText=function(V){if(this.state===P)throw new Error("SetPromptText() is not allowed in output state.");return this.ClearPromptText(!1),this._AppendPromptText(V),this._ScrollToEnd(),void 0},U.prototype.SetPromptLabel=function(V,W){return this.prompt_label_main=V,null!=W&&(this.prompt_label_continue=W),void 0},U.prototype.UpdatePromptLabel=function(){var V,W;return W=">span+span>span:first-child",V="."+p+W,this.$console.find(V).text(this.prompt_label_main)},U.prototype.Write=function(V,W,X){var Y;return null==X&&(X=!0),X&&(V=this.ansi.stylize(a(w).text(V).html())),Y=a(w).html(V),null!=W&&Y.addClass(W),this.Append(Y)},U.prototype.Append=function(V){var W;return W=a(V).insertBefore(this.$prompt),this._ScrollToEnd(),this.$prompt_cursor.detach().insertAfter(this.$prompt_left),W},U.prototype.Input=function(V){var W,X,Y,Z;if(this.state===Q)Y=this.input_callback,Z=this.multiline_callback,X=this.history_active,W=this.async_multiline,this.AbortPrompt(),this.input_queue.unshift(function(aa){return function(){return aa.Prompt(X,Y,Z,W)}}(this));else if(this.state!==P)return void this.input_queue.push(function(aa){return function(){return aa.Input(V)}}(this));return this.history_active=!1,this.input_callback=V,this.multiline_callback=null,this.state=O,this.$prompt.attr("class",l),this.$prompt_label.text(this._SelectPromptLabel(!1)),this.Focus(),this._ScrollToEnd(),void 0},U.prototype.Prompt=function(V,W,X,Y){return this.state===P?(this.history_active=V,this.input_callback=W,this.multiline_callback=X,this.async_multiline=Y,this.state=Q,this.$prompt.attr("class",p+" "+this.ansi.getClasses()),this.$prompt_label.text(this._SelectPromptLabel(!1)),this.auto_focus&&this.Focus(),this._ScrollToEnd(),void 0):void this.input_queue.push(function(Z){return function(){return Z.Prompt(V,W,X,Y)}}(this))},U.prototype.AbortPrompt=function(){var V;if(this.state===P)throw new Error("Cannot abort prompt when not in prompt or input state.");return V=this.GetPromptText(!0),this.state===O?0!==V.trim().length&&this.Write(V+N,m):this.Write(V+N,n),this.ClearPromptText(!0),this.state=P,this.input_callback=this.multiline_callback=null,this._CheckInputQueue(),void 0},U.prototype.Focus=function(){return this.IsDisabled()||this.$input_source.focus(),void 0},U.prototype.SetIndentWidth=function(V){return this.indent_width=V},U.prototype.GetIndentWidth=function(){return this.indent_width},U.prototype.RegisterMatching=function(V,W,X){var Y;return Y={opening_char:V,closing_char:W,cls:X},this.matchings.clss.push(X),this.matchings.openings[V]=Y,this.matchings.closings[W]=Y},U.prototype.UnRegisterMatching=function(V,W){var X;return X=this.matchings.openings[V].cls,delete this.matchings.openings[V],delete this.matchings.closings[W],this.matchings.clss.splice(this.matchings.clss.indexOf(X),1)},U.prototype.Dump=function(){var V,W;return V=this.$console.find("."+h).nextUntil("."+p).addBack(),function(){var X,Y,Z;for(Z=[],X=0,Y=V.length;X<Y;X++)W=V[X],a(W).is("."+n)?Z.push(a(W).text().replace(/^\s+/,">>> ")):Z.push(a(W).text());return Z}().join("")},U.prototype.GetState=function(){return this.state===O?"input":this.state===P?"output":"prompt"},U.prototype.Disable=function(){return this.$input_source.attr("disabled",!0),this.$input_source.blur()},U.prototype.Enable=function(){return this.$input_source.attr("disabled",!1)},U.prototype.IsDisabled=function(){return!!this.$input_source.attr("disabled")},U.prototype.MoveToStart=function(V){return this._MoveTo(V,!0),void 0},U.prototype.MoveToEnd=function(V){return this._MoveTo(V,!1),void 0},U.prototype.Clear=function(){var V;return V=this.state===O?l:p,this.$console.find("."+h).nextUntil("."+V).addBack().text(""),this.$prompt_cursor.detach(),this.$prompt_right.before(this.$prompt_cursor)},U.prototype._CheckInputQueue=function(){if(this.input_queue.length)return this.input_queue.shift()()},U.prototype._InitPrompt=function(){if(this.$prompt=a(R(l)).appendTo(this.$console),this.$prompt_before=a(w).appendTo(this.$prompt),this.$prompt_current=a(w).appendTo(this.$prompt),this.$prompt_after=a(w).appendTo(this.$prompt),this.$prompt_label=a(w).appendTo(this.$prompt_current),this.$prompt_left=a(w).appendTo(this.$prompt_current),this.$prompt_right=a(w).appendTo(this.$prompt_current),this.$prompt_right.css({position:"relative"}),this.$prompt_left.addClass(q),this.$prompt_cursor=a(R(g,"&nbsp;")),this.$prompt_cursor.insertBefore(this.$prompt_right),this.$prompt_cursor.css({color:"transparent",display:"inline",zIndex:0}),!this.isMobile)return this.$prompt_cursor.css("position","absolute")},U.prototype._SetupEvents=function(){return this.isMobile?this.$console.click(function(V){return function(W){return W.preventDefault(),V.Focus()}}(this)):this.$console.mouseup(function(V){return function(W){var X;return 2===W.which?V.Focus():(X=function(){if(!window.getSelection().toString())return W.preventDefault(),V.Focus()},setTimeout(X,0))}}(this)),this.$input_source.focus(function(V){return function(){var W,X;return V._ScrollToEnd(),V.$console_focused=!0,V.$console.removeClass(f),X=function(){if(V.$console_focused)return V.$console.removeClass(f)},setTimeout(X,100),W=function(){if(V.isIos&&V.$console_focused)return V.$input_source.hide()},setTimeout(W,500)}}(this)),this.$input_source.blur(function(V){return function(){var W;return V.$console_focused=!1,V.isIos&&V.$input_source.show(),W=function(){if(!V.$console_focused)return V.$console.addClass(f)},setTimeout(W,100)}}(this)),this.$input_source.bind("paste",function(V){return function(){var W;return W=function(){if(!V.in_composition)return V._AppendPromptText(V.$input_source.val()),V.$input_source.val(""),V.Focus()},setTimeout(W,0)}}(this)),this.$input_source.keypress(this._HandleChar),this.$input_source.keydown(this._HandleKey),this.$input_source.keydown(this._CheckComposition),this.$input_source.bind("compositionstart",this._StartComposition),this.$input_source.bind("compositionend",function(V){return function(W){return setTimeout(function(){return V._EndComposition(W)},0)}}(this)),this.isAndroid?(this.$input_source.bind("input",this._StartComposition),this.$input_source.bind("input",this._UpdateComposition)):this.$input_source.bind("text",this._UpdateComposition)},U.prototype.SetKeyPressHandler=function(V){return this.custom_keypress_handler=V},U.prototype.SetControlKeyHandler=function(V){return this.custom_control_key_handler=V},U.prototype._HandleChar=function(V){var W;return this.state===P||V.metaKey||V.ctrlKey||(W=V.which,8!==W&&9!==W&&13!==W)&&(null!=this.custom_keypress_handler&&!1===this.custom_keypress_handler.call(this,V)?!1:(this.$prompt_left.text(this.$prompt_left.text()+String.fromCharCode(W)),this._ScrollToEnd(),!1))},U.prototype._HandleKey=function(V){var W;if(this.state===P)return!0;if(W=V.keyCode||V.which,setTimeout(a.proxy(this._CheckMatchings,this),0),null!=this.custom_control_key_handler&&!1===this.custom_control_key_handler.call(this,V))return!1;if(V.altKey)return!0;if(V.ctrlKey||V.metaKey)return this._HandleCtrlShortcut(W);if(V.shiftKey){switch(W){case F:this._HandleEnter(!0);break;case L:this._Unindent();break;case M:this._MoveUp();break;case D:this._MoveDown();break;case J:this._ScrollPage("up");break;case I:this._ScrollPage("down");break;default:return!0;}return!1}switch(W){case F:this._HandleEnter(!1);break;case L:this._Indent();break;case C:this._Delete(!1);break;case B:this._Backspace(!1);break;case H:this._MoveLeft(!1);break;case K:this._MoveRight(!1);break;case M:this._HistoryPrevious();break;case D:this._HistoryNext();break;case G:this.MoveToStart(!1);break;case E:this.MoveToEnd(!1);break;case J:this._ScrollPage("up");break;case I:this._ScrollPage("down");break;default:return!0;}return!1},U.prototype._HandleCtrlShortcut=function(V){var W,X,Y,Z;switch(V){case C:this._Delete(!0);break;case B:this._Backspace(!0);break;case H:this._MoveLeft(!0);break;case K:this._MoveRight(!0);break;case M:this._MoveUp();break;case D:this._MoveDown();break;case E:this.MoveToEnd(!0);break;case G:this.MoveToStart(!0);break;default:if(V in this.shortcuts){for(Z=this.shortcuts[V],X=0,Y=Z.length;X<Y;X++)W=Z[X],W.call(this);return!1}return!0;}return!1},U.prototype._HandleEnter=function(V){var W,X;return this._EndComposition(),V?this._InsertNewLine(!0):(X=this.GetPromptText(),W=function(Y){return function(Z){var aa,ba,ca,da,ea,fa;if(!1!==Z){for(Y.MoveToEnd(!0),Y._InsertNewLine(!0),fa=[],(aa=da=0,ea=Math.abs(Z));0<=ea?da<ea:da>ea;aa=0<=ea?++da:--da)0<Z?fa.push(Y._Indent()):fa.push(Y._Unindent());return fa}return ca=Y.state===O?"input":"prompt",Y.Write(Y.GetPromptText(!0)+N,o+"old-"+ca),Y.ClearPromptText(!0),Y.history_active&&((!Y.history.length||Y.history[Y.history.length-1]!==X)&&Y.history.push(X),Y.history_index=Y.history.length),Y.state=P,ba=Y.input_callback,Y.input_callback=null,ba&&ba(X),Y._CheckInputQueue()}}(this),this.multiline_callback?this.async_multiline?this.multiline_callback(X,W):W(this.multiline_callback(X)):W(!1))},U.prototype._GetDirectionals=function(V){var W,X,Y,Z,aa,ba,ca,da;return Z=V?this.$prompt_left:this.$prompt_right,W=V?this.$prompt_right:this.$prompt_left,Y=V?this.$prompt_before:this.$prompt_after,X=V?this.$prompt_after:this.$prompt_before,ba=V?a.proxy(this.MoveToStart,this):a.proxy(this.MoveToEnd,this),aa=V?a.proxy(this._MoveLeft,this):a.proxy(this._MoveRight,this),da=V?"last":"first",ca=V?"prependTo":"appendTo",{$prompt_which:Z,$prompt_opposite:W,$prompt_relative:Y,$prompt_rel_opposite:X,MoveToLimit:ba,MoveDirection:aa,which_end:da,where_append:ca}},U.prototype._VerticalMove=function(V){var W,X,Y,Z,aa,ba,ca,da;if(ca=this._GetDirectionals(V),Y=ca.$prompt_which,W=ca.$prompt_opposite,X=ca.$prompt_relative,aa=ca.MoveToLimit,Z=ca.MoveDirection,!X.is(v))return ba=this.$prompt_left.text().length,aa(),Z(),da=Y.text(),W.text(V?da.slice(ba):da.slice(0,ba)),Y.text(V?da.slice(0,ba):da.slice(ba))},U.prototype._MoveUp=function(){return this._VerticalMove(!0)},U.prototype._MoveDown=function(){return this._VerticalMove()},U.prototype._HorizontalMove=function(V,W){var X,Y,Z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka;return(ea=this._GetDirectionals(W),ba=ea.$prompt_which,Y=ea.$prompt_opposite,aa=ea.$prompt_relative,Z=ea.$prompt_rel_opposite,ja=ea.which_end,ia=ea.where_append,fa=W?/\w*\W*$/:/^\w*\W*/,ga=ba.text(),ga)?V?(ka=ga.match(fa),!ka)?void 0:(ka=ka[0],ha=Y.text(),Y.text(W?ka+ha:ha+ka),da=ka.length,ba.text(W?ga.slice(0,-da):ga.slice(da))):(ha=Y.text(),Y.text(W?ga.slice(-1)+ha:ha+ga[0]),ba.text(W?ga.slice(0,-1):ga.slice(1))):aa.is(v)?void 0:(ca=a(w)[ia](Z),ca.append(a(w).text(this.$prompt_label.text())),ca.append(a(w).text(Y.text())),X=aa.children()[ja]().detach(),this.$prompt_label.text(X.children().first().text()),ba.text(X.children().last().text()),Y.text(""))},U.prototype._MoveLeft=function(V){return this._HorizontalMove(V,!0)},U.prototype._MoveRight=function(V){return this._HorizontalMove(V)},U.prototype._MoveTo=function(V,W){var X,Y,Z,aa,ba,ca,da;if(ca=this._GetDirectionals(W),Z=ca.$prompt_which,X=ca.$prompt_opposite,Y=ca.$prompt_relative,ba=ca.MoveToLimit,aa=ca.MoveDirection,V){for(da=[];!(Y.is(v)&&""===Z.text());)ba(!1),da.push(aa(!1));return da}return X.text(this.$prompt_left.text()+this.$prompt_right.text()),Z.text("")},U.prototype._Delete=function(V){var W,X,Y;return(X=this.$prompt_right.text(),X)?V?(Y=X.match(/^\w*\W*/),!Y)?void 0:(Y=Y[0],this.$prompt_right.text(X.slice(Y.length))):this.$prompt_right.text(X.slice(1)):this.$prompt_after.is(v)?void 0:(W=this.$prompt_after.children().first().detach(),this.$prompt_right.text(W.children().last().text()))},U.prototype._Backspace=function(V){var W,X,Y;return(setTimeout(a.proxy(this._ScrollToEnd,this),0),X=this.$prompt_left.text(),X)?V?(Y=X.match(/\w*\W*$/),!Y)?void 0:(Y=Y[0],this.$prompt_left.text(X.slice(0,-Y.length))):this.$prompt_left.text(X.slice(0,-1)):this.$prompt_before.is(v)?void 0:(W=this.$prompt_before.children().last().detach(),this.$prompt_label.text(W.children().first().text()),this.$prompt_left.text(W.children().last().text()))},U.prototype._Indent=function(){var V;return this.$prompt_left.prepend(function(){var W,X,Y;for(Y=[],V=W=1,X=this.indent_width;1<=X?W<=X:W>=X;V=1<=X?++W:--W)Y.push(" ");return Y}.call(this).join(""))},U.prototype._Unindent=function(){var V,W,X,Y,Z;for(X=this.$prompt_left.text()+this.$prompt_right.text(),Z=[],(V=W=1,Y=this.indent_width);(1<=Y?W<=Y:W>=Y)&&!!/^ /.test(X);V=1<=Y?++W:--W)this.$prompt_left.text()?this.$prompt_left.text(this.$prompt_left.text().slice(1)):this.$prompt_right.text(this.$prompt_right.text().slice(1)),Z.push(X=X.slice(1));return Z},U.prototype._InsertNewLine=function(V){var W,X,Y;return null==V&&(V=!1),Y=this._SelectPromptLabel(!this.$prompt_before.is(v)),W=a(w).appendTo(this.$prompt_before),W.append(a(w).text(Y)),W.append(a(w).addClass(q).text(this.$prompt_left.text())),this.$prompt_label.text(this._SelectPromptLabel(!0)),V&&(X=this.$prompt_left.text().match(/^\s+/))?this.$prompt_left.text(X[0]):this.$prompt_left.text(""),this._ScrollToEnd()},U.prototype._AppendPromptText=function(V){var W,X,Y,Z,aa,ba;for(Z=V.split(N),this.$prompt_left.text(this.$prompt_left.text()+Z[0]),aa=Z.slice(1),ba=[],(W=0,X=aa.length);W<X;W++)Y=aa[W],this._InsertNewLine(),ba.push(this.$prompt_left.text(Y));return ba},U.prototype._ScrollPage=function(V){var W;return W=this.$container[0].scrollTop,"up"===V?W-=this.$container.height():W+=this.$container.height(),this.$container.stop().animate({scrollTop:W},"fast")},U.prototype._ScrollToEnd=function(){var V;if(this.$container.scrollTop(this.$container[0].scrollHeight),V=this.$prompt_cursor.position(),this.$input_container.css({left:V.left,top:V.top}),this.auto_focus)return setTimeout(this.ScrollWindowToPrompt.bind(this),50)},U.prototype.ScrollWindowToPrompt=function(){var V,W,X,Y,Z,aa;if(W=this.$prompt_cursor.height(),aa=this.$window.scrollTop(),Z=this.$window.scrollLeft(),V=document.documentElement.clientHeight,Y=this.$prompt_cursor.offset(),X=Y.top-2*W,!(this.isMobile&&"undefined"!=typeof orientation&&null!==orientation)){if(aa+V<Y.top)return this.$window.scrollTop(Y.top-V+W);if(aa>X)return this.$window.scrollTop(Y.top)}else if(aa<Y.top||aa>Y.top)return this.$window.scrollTop(X)},U.prototype._SelectPromptLabel=function(V){return this.state===Q?V?" \n"+this.prompt_label_continue:this.prompt_label_main:V?"\n ":" "},U.prototype._Wrap=function(V,W,X){var Y,Z;return Z=V.html(),Y=Z.slice(0,W)+R(X,Z[W])+Z.slice(W+1),V.html(Y)},U.prototype._WalkCharacters=function(V,W,X,Y,Z){var aa,ba,ca;for(ba=Z?V.length:0,V=V.split(""),ca=function(){var da,ea,fa,ga;return Z?(ea=V,V=2<=ea.length?T.call(ea,0,da=ea.length-1):(da=0,[]),ga=ea[da++]):(fa=V,ga=fa[0],V=2<=fa.length?T.call(fa,1):[]),ga&&(ba+=Z?-1:1),ga};aa=ca();)if(aa===W?Y++:aa===X&&Y--,0===Y)return{index:ba,current_count:Y};return{index:-1,current_count:Y}},U.prototype._ProcessMatch=function(V,W,X){var Y,Z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja;return ga=W?[V.closing_char,V.opening_char]:[V.opening_char,V.closing_char],ba=ga[0],fa=ga[1],ha=this._GetDirectionals(W),aa=ha.$prompt_which,Z=ha.$prompt_relative,ca=1,da=!1,ja=aa.html(),W||(ja=ja.slice(1)),X&&W&&(ja=ja.slice(0,-1)),ia=this._WalkCharacters(ja,ba,fa,ca,W),ea=ia.index,ca=ia.current_count,-1<ea?(this._Wrap(aa,ea,V.cls),da=!0):(Y=Z.children(),Y=W?Array.prototype.reverse.call(Y):Y,Y.each(function(ka){return function(la,ma){var na,oa;if(na=a(ma).children().last(),ja=na.html(),oa=ka._WalkCharacters(ja,ba,fa,ca,W),ea=oa.index,ca=oa.current_count,-1<ea)return W||ea--,ka._Wrap(na,ea,V.cls),da=!0,!1}}(this))),da},U.prototype._CheckMatchings=function(V){var W,X,Y,Z,aa,ba,ca;for(Y=V?this.$prompt_left.text().slice(this.$prompt_left.text().length-1):this.$prompt_right.text()[0],ca=this.matchings.clss,(aa=0,ba=ca.length);aa<ba;aa++)W=ca[aa],a("."+W,this.$console).contents().unwrap();if((X=this.matchings.closings[Y])?Z=this._ProcessMatch(X,!0,V):(X=this.matchings.openings[Y])?Z=this._ProcessMatch(X,!1,V):!V&&this._CheckMatchings(!0),V){if(Z)return this._Wrap(this.$prompt_left,this.$prompt_left.html().length-1,X.cls);}else if(Z)return this._Wrap(this.$prompt_right,0,X.cls)},U.prototype._HistoryPrevious=function(){if(this.history_active)return 0>=this.history_index?void 0:(this.history_index===this.history.length&&(this.history_new=this.GetPromptText()),this.SetPromptText(this.history[--this.history_index]))},U.prototype._HistoryNext=function(){return this.history_active?this.history_index>=this.history.length?void 0:this.history_index===this.history.length-1?(this.history_index++,this.SetPromptText(this.history_new)):this.SetPromptText(this.history[++this.history_index]):void 0},U.prototype._CheckComposition=function(V){var W;if(W=V.keyCode||V.which,229===W)return this.in_composition?this._UpdateComposition():this._StartComposition()},U.prototype._StartComposition=function(){if(!this.in_composition)return this.in_composition=!0,this._ShowComposition(),setTimeout(this._UpdateComposition,0)},U.prototype._EndComposition=function(){if(this.in_composition)return this._HideComposition(),this.$prompt_left.text(this.$prompt_left.text()+this.$composition.text()),this.$composition.text(""),this.$input_source.val(""),this.in_composition=!1},U.prototype._UpdateComposition=function(){var W;return W=function(X){return function(){return X.in_composition?X.$composition.text(X.$input_source.val()):void 0}}(this),setTimeout(W,0)},U.prototype._ShowComposition=function(){return this.$composition.css("height",this.$prompt_cursor.height()),this.$composition.empty(),this.$composition.appendTo(this.$prompt_left)},U.prototype._HideComposition=function(){return this.$composition.detach()},U}(),a.fn.jqconsole=function(U,V,W,X){return new A(this,U,V,W,X)},a.fn.jqconsole.JQConsole=A,a.fn.jqconsole.Ansi=b}).call(this);