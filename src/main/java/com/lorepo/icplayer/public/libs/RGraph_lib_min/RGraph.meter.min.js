    /**
    * o------------------------------------------------------------------------------o
    * | This file is part of the RGraph package - you can learn more at:             |
    * |                                                                              |
    * |                          http://www.rgraph.net                               |
    * |                                                                              |
    * | This package is licensed under the RGraph license. For all kinds of business |
    * | purposes there is a small one-time licensing fee to pay and for non          |
    * | commercial  purposes it is free to use. You can read the full license here:  |
    * |                                                                              |
    * |                      http://www.rgraph.net/LICENSE.txt                       |
    * o------------------------------------------------------------------------------o
    */

"undefined"==typeof RGraph&&(RGraph={});
RGraph.Meter=function(g,k,l,n){this.id=g;this.canvas=document.getElementById("object"===typeof g?g.id:g);this.context=this.canvas.getContext?this.canvas.getContext("2d"):null;this.canvas.__object__=this;this.type="meter";this.min=k;this.max=l;this.value=n;this.radius=this.centery=this.centerx=null;this.isRGraph=!0;this.currentValue=null;this.uid=RGraph.CreateUID();this.canvas.uid=this.canvas.uid?this.canvas.uid:RGraph.CreateUID();this.colorsParsed=!1;this.coordsText=[];RGraph.OldBrowserCompat(this.context);
this.properties={"chart.background.color":"white","chart.gutter.left":15,"chart.gutter.right":15,"chart.gutter.top":15,"chart.gutter.bottom":15,"chart.linewidth":1,"chart.linewidth.segments":0,"chart.strokestyle":null,"chart.border":!0,"chart.border.color":"black","chart.text.font":"Arial","chart.text.size":10,"chart.text.color":"black","chart.value.text.decimals":0,"chart.value.text.units.pre":"","chart.value.text.units.post":"","chart.title":"","chart.title.background":null,"chart.title.hpos":null,
"chart.title.vpos":null,"chart.title.color":"black","chart.title.bold":!0,"chart.title.font":null,"chart.title.x":null,"chart.title.y":null,"chart.title.halign":null,"chart.title.valign":null,"chart.green.start":0.35*(this.max-this.min)+this.min,"chart.green.end":this.max,"chart.green.color":"#207A20","chart.yellow.start":0.1*(this.max-this.min)+this.min,"chart.yellow.end":0.35*(this.max-this.min)+this.min,"chart.yellow.color":"#D0AC41","chart.red.start":this.min,"chart.red.end":0.1*(this.max-this.min)+
this.min,"chart.red.color":"#9E1E1E","chart.colors.ranges":null,"chart.units.pre":"","chart.units.post":"","chart.contextmenu":null,"chart.zoom.factor":1.5,"chart.zoom.fade.in":!0,"chart.zoom.fade.out":!0,"chart.zoom.hdir":"right","chart.zoom.vdir":"down","chart.zoom.frames":25,"chart.zoom.delay":16.666,"chart.zoom.shadow":!0,"chart.zoom.background":!0,"chart.zoom.action":"zoom","chart.annotatable":!1,"chart.annotate.color":"black","chart.shadow":!1,"chart.shadow.color":"rgba(0,0,0,0.5)","chart.shadow.blur":3,
"chart.shadow.offsetx":3,"chart.shadow.offsety":3,"chart.resizable":!1,"chart.resize.handle.adjust":[0,0],"chart.resize.handle.background":null,"chart.tickmarks.small.num":100,"chart.tickmarks.big.num":10,"chart.tickmarks.small.color":"#bbb","chart.tickmarks.big.color":"black","chart.scale.decimals":0,"chart.scale.point":".","chart.scale.thousand":",","chart.radius":null,"chart.centerx":null,"chart.centery":null,"chart.labels":!0,"chart.segment.radius.start":0,"chart.needle.radius":null,"chart.needle.tail":!1,
"chart.adjustable":!1,"chart.angles.start":PI,"chart.angles.end":TWOPI};if(this.canvas){this.canvas.__rgraph_aa_translated__||(this.context.translate(0.5,0.5),this.canvas.__rgraph_aa_translated__=!0);var e=RGraph,h=this.canvas,b=h.getContext("2d"),a=this.properties;this.Set=function(b,c){b=b.toLowerCase();b.substr(0,6)!="chart."&&(b="chart."+b);if(b=="chart.value")this.value=c;else{a[b]=c;return this}};this.Get=function(b){b.substr(0,6)!="chart."&&(b="chart."+b);return b=="chart.value"?this.value:
a[b]};this.Draw=function(){e.FireCustomEvent(this,"onbeforedraw");if(this.value>this.max)this.value=this.max;if(this.value<this.min)this.value=this.min;this.currentValue=this.value;this.gutterLeft=a["chart.gutter.left"];this.gutterRight=a["chart.gutter.right"];this.gutterTop=a["chart.gutter.top"];this.gutterBottom=a["chart.gutter.bottom"];this.centerx=(h.width-this.gutterLeft-this.gutterRight)/2+this.gutterLeft;this.centery=h.height-this.gutterBottom;this.radius=Math.min((h.width-this.gutterLeft-
this.gutterRight)/2,h.height-this.gutterTop-this.gutterBottom);if(typeof a["chart.centerx"]=="number")this.centerx=a["chart.centerx"];if(typeof a["chart.centery"]=="number")this.centery=a["chart.centery"];if(typeof a["chart.radius"]=="number")this.radius=a["chart.radius"];if(!this.colorsParsed){this.parseColors();this.colorsParsed=true}this.DrawBackground();this.DrawNeedle();this.DrawLabels();this.DrawReadout();e.DrawTitle(this,a["chart.title"],this.gutterTop,null,a["chart.title.size"]?a["chart.title.size"]:
a["chart.text.size"]+2);a["chart.contextmenu"]&&e.ShowContext(this);a["chart.resizable"]&&e.AllowResizing(this);e.InstallEventListeners(this);e.FireCustomEvent(this,"ondraw");return this};this.DrawBackground=function(){b.beginPath();b.fillStyle=a["chart.background.color"];a["chart.shadow"]&&e.SetShadow(this,a["chart.shadow.color"],a["chart.shadow.offsetx"],a["chart.shadow.offsety"],a["chart.shadow.blur"]);b.moveTo(this.centerx,this.centery);b.arc(this.centerx,this.centery,this.radius,a["chart.angles.start"],
a["chart.angles.end"],false);b.fill();e.NoShadow(this);if(a["chart.shadow"]){b.beginPath();b.arc(this.centerx,this.centery,this.radius*0.06>40?40:this.radius*0.06,0,TWOPI,0);b.fill();e.NoShadow(this)}if(a["chart.tickmarks.small.num"]){for(var d=0;d<a["chart.angles.end"]-a["chart.angles.start"];d=d+PI/a["chart.tickmarks.small.num"]){b.beginPath();b.strokeStyle=a["chart.tickmarks.small.color"];b.arc(this.centerx,this.centery,this.radius,a["chart.angles.start"]+d,a["chart.angles.start"]+d+1E-5,0);b.arc(this.centerx,
this.centery,this.radius-5,a["chart.angles.start"]+d,a["chart.angles.start"]+d+1E-5,0);b.stroke()}b.beginPath();b.fillStyle=a["chart.background.color"];b.arc(this.centerx,this.centery,this.radius-4,a["chart.angles.start"],a["chart.angles.end"],false);b.closePath();b.fill()}if(a["chart.tickmarks.big.num"])for(var c=["white","white",a["chart.tickmarks.big.color"]],i=0;i<c.length;++i)for(d=0;d<a["chart.angles.end"]-a["chart.angles.start"];d=d+(a["chart.angles.end"]-a["chart.angles.start"])/a["chart.tickmarks.big.num"]){b.beginPath();
b.strokeStyle=c[i];b.arc(this.centerx,this.centery,this.radius,a["chart.angles.start"]+d,a["chart.angles.start"]+d+0.001,0);b.arc(this.centerx,this.centery,this.radius-5,a["chart.angles.start"]+d,a["chart.angles.start"]+d+1E-4,0);b.stroke()}b.beginPath();b.fillStyle=a["chart.background.color"];b.moveTo(this.centerx,this.centery);b.arc(this.centerx,this.centery,this.radius-7,a["chart.angles.start"],a["chart.angles.end"],false);b.closePath();b.fill();c=a["chart.colors.ranges"];if(e.is_array(a["chart.colors.ranges"])){c=
a["chart.colors.ranges"];for(d=0;d<c.length;++d){b.strokeStyle=a["chart.strokestyle"]?a["chart.strokestyle"]:c[d][2];b.fillStyle=c[d][2];b.lineWidth=a["chart.linewidth.segments"];b.beginPath();b.arc(this.centerx,this.centery,this.radius*0.85,(c[d][0]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(c[d][1]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],false);a["chart.segment.radius.start"]>
0?b.arc(this.centerx,this.centery,a["chart.segment.radius.start"],(c[d][1]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(c[d][0]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],true):b.lineTo(this.centerx,this.centery);b.closePath();b.stroke();b.fill()}b.beginPath()}else{b.lineWidth=a["chart.linewidth"];b.strokeStyle=a["chart.strokestyle"]?a["chart.strokestyle"]:a["chart.green.color"];b.fillStyle=
a["chart.green.color"];b.lineWidth=a["chart.linewidth.segments"];b.beginPath();b.arc(this.centerx,this.centery,this.radius*0.85,(a["chart.green.start"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-this.properties["chart.angles.start"])+a["chart.angles.start"],(a["chart.green.end"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],false);a["chart.segment.radius.start"]>0?b.arc(this.centerx,this.centery,a["chart.segment.radius.start"],(a["chart.green.end"]-
this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(a["chart.green.start"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],true):b.lineTo(this.centerx,this.centery);b.closePath();b.stroke();b.fill();b.strokeStyle=a["chart.strokestyle"]?a["chart.strokestyle"]:a["chart.yellow.color"];b.fillStyle=a["chart.yellow.color"];b.lineWidth=a["chart.linewidth.segments"];b.beginPath();b.arc(this.centerx,this.centery,
this.radius*0.85,(a["chart.yellow.start"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(a["chart.yellow.end"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],false);a["chart.segment.radius.start"]>0?b.arc(this.centerx,this.centery,a["chart.segment.radius.start"],(a["chart.yellow.end"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(a["chart.yellow.start"]-
this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],true):b.lineTo(this.centerx,this.centery);b.closePath();b.stroke();b.fill();b.strokeStyle=a["chart.strokestyle"]?a["chart.strokestyle"]:a["chart.red.color"];b.fillStyle=a["chart.red.color"];b.lineWidth=a["chart.linewidth.segments"];b.beginPath();b.arc(this.centerx,this.centery,this.radius*0.85,(a["chart.red.start"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],
(a["chart.red.end"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],false);a["chart.segment.radius.start"]>0?b.arc(this.centerx,this.centery,a["chart.segment.radius.start"],(a["chart.red.end"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],(a["chart.red.start"]-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"],true):b.lineTo(this.centerx,
this.centery);b.closePath();b.stroke();b.fill();b.lineWidth=1}if(a["chart.border"]){b.strokeStyle=a["chart.border.color"];b.lineWidth=a["chart.linewidth"];b.beginPath();b.moveTo(this.centerx,this.centery);b.arc(this.centerx,this.centery,this.radius,a["chart.angles.start"],a["chart.angles.end"],false);b.closePath()}b.stroke();b.lineWidth=1};this.DrawNeedle=function(){var d=typeof a["chart.needle.radius"]=="number"?a["chart.needle.radius"]:this.radius*0.7;b.fillStyle="black";b.lineWidth=this.radius>=
200?7:3;b.lineCap="round";b.beginPath();b.strokeStyle="black";if(typeof a["chart.needle.linewidth"]=="number")b.lineWidth=a["chart.needle.linewidth"];var c=(this.value-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"];b.arc(this.centerx,this.centery,d,c,c+0.001,false);b.lineTo(this.centerx,this.centery);b.stroke();b.beginPath();b.lineWidth=1;b.arc(this.centerx,this.centery,d+15,c,c+0.001,0);b.arc(this.centerx,this.centery,d-15,c+0.087,c+0.087999,
0);b.arc(this.centerx,this.centery,d-15,c-0.087,c-0.087999,1);b.fill();if(a["chart.needle.tail"]){b.beginPath();b.strokeStyle="black";if(typeof a["chart.needle.linewidth"]=="number")b.lineWidth=a["chart.needle.linewidth"];c=(this.value-this.min)/(this.max-this.min)*(this.properties["chart.angles.end"]-this.properties["chart.angles.start"])+this.properties["chart.angles.start"]+PI;b.arc(this.centerx,this.centery,25,c,c+0.001,false);b.lineTo(this.centerx,this.centery);b.stroke()}d=this.radius*0.06>
40?40:this.radius*0.06;b.beginPath();b.arc(this.centerx,this.centery,d,0.001,TWOPI,0);b.fill();b.fillStyle="white";b.beginPath();b.arc(this.centerx,this.centery,d-2,0.001,TWOPI,0);b.fill()};this.DrawLabels=function(){if(a["chart.labels"]){var d=a["chart.text.size"],c=a["chart.text.font"],i=a["chart.units.post"],h=a["chart.units.pre"],o=this.centerx,g=this.centery,k=a["chart.scale.decimals"];b.fillStyle=a["chart.text.color"];b.lineWidth=1;b.beginPath();for(var f=0;f<=10;++f){var m=e.getRadiusEndPoint(o,
g,(a["chart.angles.end"]-a["chart.angles.start"])*(f/10)+a["chart.angles.start"]+((f==0||f==10)&&a["chart.border"]?f==0?0.05:-0.05:0),this.radius*0.925),j=a["chart.angles.start"],l=j*(180/PI),j=(a["chart.angles.end"]-j)*(180/PI);valign="center";halign=a["chart.border"]?f==0?"left":f==10?"right":"center":"center";e.Text2(this,{font:c,size:d,x:m[0],y:m[1],text:e.number_format(this,((this.max-this.min)*(f/10)+this.min).toFixed(k),h,i),halign:halign,valign:valign,angle:j*0.1*f+l-270,bounding:false,boundingFill:f==
0||f==10?"white":null,tag:"scale"})}}};this.DrawReadout=function(){if(a["chart.value.text"]){b.beginPath();e.Text2(this,{font:a["chart.text.font"],size:a["chart.text.size"],x:this.centerx,y:this.centery-a["chart.text.size"]-15,text:a["chart.value.text.units.pre"]+this.value.toFixed(a["chart.value.text.decimals"])+a["chart.value.text.units.post"],halign:"center",valign:"bottom",bounding:true,boundingFill:"white",tag:"value.text"});b.stroke();b.fill()}};this.getShape=function(){};this.getValue=function(b){var b=
e.getMouseXY(b),c=e.getAngleByXY(this.centerx,this.centery,b[0],b[1]);if(e.getHypLength(this.centerx,this.centery,b[0],b[1])>this.radius)return null;c<HALFPI&&(c=c+TWOPI);b=(c-a["chart.angles.start"])/(a["chart.angles.end"]-a["chart.angles.start"])*(this.max-this.min)+this.min;b=Math.max(b,this.min);return b=Math.min(b,this.max)};this.getObjectByXY=function(a){var a=RGraph.getMouseXY(a),b=e.getHypLength(this.centerx,this.centery,a[0],a[1]);if(a[0]>this.centerx-this.radius&&a[0]<this.centerx+this.radius&&
a[1]>this.centery-this.radius&&a[1]<this.centery+this.radius&&b<=this.radius)return this};this.Adjusting_mousemove=function(b){if(a["chart.adjustable"]&&e.Registry.Get("chart.adjusting")&&e.Registry.Get("chart.adjusting").uid==this.uid){this.value=this.getValue(b);e.Clear(this.canvas);e.RedrawCanvas(this.canvas);e.FireCustomEvent(this,"onadjust")}};this.getAngle=function(b){return b>this.max||b<this.min?null:(b-this.min)/(this.max-this.min)*(a["chart.angles.end"]-a["chart.angles.start"])+a["chart.angles.start"]};
this.parseColors=function(){a["chart.green.color"]=this.parseSingleColorForGradient(a["chart.green.color"]);a["chart.yellow.color"]=this.parseSingleColorForGradient(a["chart.yellow.color"]);a["chart.red.color"]=this.parseSingleColorForGradient(a["chart.red.color"]);var b=a["chart.colors.ranges"];if(b&&b.length)for(var c=0;c<b.length;++c)b[c][2]=this.parseSingleColorForGradient(b[c][2])};this.parseSingleColorForGradient=function(d){if(!d||typeof d!="string")return d;if(d.match(/^gradient\((.*)\)$/i))for(var c=
RegExp.$1.split(":"),i=b.createRadialGradient(this.centerx,this.centery,a["chart.segment.radius.start"],this.centerx,this.centery,this.radius*0.85),h=1/(c.length-1),g=0;g<c.length;++g)i.addColorStop(g*h,e.trim(c[g]));return i?i:d};e.Register(this)}else alert("[METER] No canvas support")};
