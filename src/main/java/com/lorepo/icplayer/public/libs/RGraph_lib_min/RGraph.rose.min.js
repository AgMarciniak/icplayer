    /**
    * o------------------------------------------------------------------------------o
    * | This file is part of the RGraph package - you can learn more at:             |
    * |                                                                              |
    * |                          http://www.rgraph.net                               |
    * |                                                                              |
    * | This package is licensed under the RGraph license. For all kinds of business |
    * | purposes there is a small one-time licensing fee to pay and for non          |
    * | commercial  purposes it is free to use. You can read the full license here:  |
    * |                                                                              |
    * |                      http://www.rgraph.net/LICENSE.txt                       |
    * o------------------------------------------------------------------------------o
    */

"undefined"==typeof RGraph&&(RGraph={});
RGraph.Rose=function(p,r){this.id=p;this.canvas=document.getElementById("object"===typeof p?p.id:p);this.context=this.canvas.getContext("2d");this.data=r;this.canvas.__object__=this;this.type="rose";this.isRGraph=!0;this.uid=RGraph.CreateUID();this.canvas.uid=this.canvas.uid?this.canvas.uid:RGraph.CreateUID();this.colorsParsed=!1;this.coordsText=[];RGraph.OldBrowserCompat(this.context);this.max=this.radius=this.centery=this.centerx=0;this.angles=[];this.angles2=[];this.properties={"chart.background.axes":!0,
"chart.background.axes.color":"black","chart.background.grid":!0,"chart.background.grid.color":"#ccc","chart.background.grid.size":null,"chart.background.grid.spokes":null,"chart.background.grid.count":5,"chart.centerx":null,"chart.centery":null,"chart.radius":null,"chart.angles.start":0,"chart.colors":"rgba(255,0,0,0.5) rgba(255,255,0,0.5) rgba(0,255,255,0.5) rgb(0,255,0) gray blue rgb(255,128,255) green pink gray aqua".split(" "),"chart.colors.sequential":!1,"chart.colors.alpha":null,"chart.margin":0,
"chart.strokestyle":"#aaa","chart.gutter.left":25,"chart.gutter.right":25,"chart.gutter.top":25,"chart.gutter.bottom":25,"chart.title":"","chart.title.background":null,"chart.title.hpos":null,"chart.title.vpos":null,"chart.title.bold":!0,"chart.title.font":null,"chart.title.x":null,"chart.title.y":null,"chart.title.halign":null,"chart.title.valign":null,"chart.labels":null,"chart.labels.position":"center","chart.labels.axes":"nsew","chart.labels.offset":0,"chart.text.color":"black","chart.text.font":"Arial",
"chart.text.size":10,"chart.key":null,"chart.key.background":"white","chart.key.position":"graph","chart.key.halign":"right","chart.key.shadow":!1,"chart.key.shadow.color":"#666","chart.key.shadow.blur":3,"chart.key.shadow.offsetx":2,"chart.key.shadow.offsety":2,"chart.key.position.gutter.boxed":!1,"chart.key.position.x":null,"chart.key.position.y":null,"chart.key.color.shape":"square","chart.key.rounded":!0,"chart.key.linewidth":1,"chart.key.colors":null,"chart.key.interactive":!1,"chart.key.interactive.highlight.chart.stroke":"black",
"chart.key.interactive.highlight.chart.fill":"rgba(255,255,255,0.7)","chart.key.interactive.highlight.label":"rgba(255,0,0,0.2)","chart.key.text.color":"black","chart.contextmenu":null,"chart.tooltips":null,"chart.tooltips.event":"onclick","chart.tooltips.effect":"fade","chart.tooltips.css.class":"RGraph_tooltip","chart.tooltips.highlight":!0,"chart.highlight.stroke":"rgba(0,0,0,0)","chart.highlight.fill":"rgba(255,255,255,0.7)","chart.annotatable":!1,"chart.annotate.color":"black","chart.zoom.factor":1.5,
"chart.zoom.fade.in":!0,"chart.zoom.fade.out":!0,"chart.zoom.hdir":"right","chart.zoom.vdir":"down","chart.zoom.frames":25,"chart.zoom.delay":16.666,"chart.zoom.shadow":!0,"chart.zoom.background":!0,"chart.zoom.action":"zoom","chart.resizable":!1,"chart.resize.handle.adjust":[0,0],"chart.resize.handle.background":null,"chart.adjustable":!1,"chart.ymax":null,"chart.ymin":0,"chart.scale.decimals":null,"chart.scale.point":".","chart.scale.thousand":",","chart.variant":"stacked","chart.exploded":0,"chart.events.mousemove":null,
"chart.events.click":null,"chart.animation.roundrobin.factor":1,"chart.animation.roundrobin.radius":!0,"chart.animation.grow.multiplier":1,"chart.labels.count":5};for(var s=RGraph.array_linearize(this.data),q=0;q<s.length;++q)this["$"+q]={};this.canvas.__rgraph_aa_translated__||(this.context.translate(0.5,0.5),this.canvas.__rgraph_aa_translated__=!0);var l=RGraph,o=this.canvas,b=o.getContext("2d"),a=this.properties;this.Set=function(c,d){c.substr(0,6)!="chart."&&(c="chart."+c);a[c.toLowerCase()]=
d;return this};this.Get=function(c){c.substr(0,6)!="chart."&&(c="chart."+c);return a[c.toLowerCase()]};this.Draw=function(){l.FireCustomEvent(this,"onbeforedraw");this.gutterLeft=a["chart.gutter.left"];this.gutterRight=a["chart.gutter.right"];this.gutterTop=a["chart.gutter.top"];this.gutterBottom=a["chart.gutter.bottom"];this.radius=Math.min(o.width-this.gutterLeft-this.gutterRight,o.height-this.gutterTop-this.gutterBottom)/2;this.centerx=(o.width-this.gutterLeft-this.gutterRight)/2+this.gutterLeft;
this.centery=(o.height-this.gutterTop-this.gutterBottom)/2+this.gutterTop;this.angles=[];this.angles2=[];this.total=0;this.startRadians=a["chart.angles.start"];if(a["chart.key"]&&a["chart.key"].length>0&&a["chart.key"].length>=3)this.centerx=this.centerx-this.gutterRight+5;if(typeof a["chart.centerx"]=="number")this.centerx=a["chart.centerx"];if(typeof a["chart.centery"]=="number")this.centery=a["chart.centery"];if(typeof a["chart.radius"]=="number")this.radius=a["chart.radius"];if(!this.colorsParsed){this.parseColors();
this.colorsParsed=true}this.DrawBackground();this.DrawRose();this.DrawLabels();a["chart.contextmenu"]&&l.ShowContext(this);a["chart.resizable"]&&l.AllowResizing(this);a["chart.adjustable"]&&l.AllowAdjusting(this);l.InstallEventListeners(this);l.FireCustomEvent(this,"ondraw");return this};this.DrawBackground=function(){b.lineWidth=1;if(a["chart.background.grid"]){typeof a["chart.background.grid.count"]=="number"&&(a["chart.background.grid.size"]=this.radius/a["chart.background.grid.count"]);b.beginPath();
b.strokeStyle=a["chart.background.grid.color"];for(var c=a["chart.background.grid.size"];c<=this.radius;c=c+a["chart.background.grid.size"]){b.moveTo(this.centerx+c,this.centery);b.arc(this.centerx,this.centery,c,0,TWOPI,false)}b.stroke();b.beginPath();if(typeof a["chart.background.grid.spokes"]=="number")for(var d=360/a["chart.background.grid.spokes"],c=d;c<=360;c=c+d){b.arc(this.centerx,this.centery,this.radius,c/(180/PI)-HALFPI+this.startRadians,(c+1E-4)/(180/PI)-HALFPI+this.startRadians,false);
b.lineTo(this.centerx,this.centery)}else for(c=15;c<=360;c=c+15){b.arc(this.centerx,this.centery,this.radius,c/(180/PI)-HALFPI,(c+1E-4)/(180/PI)-HALFPI,false);b.lineTo(this.centerx,this.centery)}b.stroke()}if(a["chart.background.axes"]){b.beginPath();b.strokeStyle=a["chart.background.axes.color"];b.moveTo(this.centerx-this.radius,Math.round(this.centery));b.lineTo(this.centerx+this.radius,Math.round(this.centery));b.moveTo(Math.round(this.centerx-this.radius),this.centery-5);b.lineTo(Math.round(this.centerx-
this.radius),this.centery+5);b.moveTo(Math.round(this.centerx+this.radius),this.centery-5);b.lineTo(Math.round(this.centerx+this.radius),this.centery+5);for(c=this.centerx-this.radius;c<this.centerx+this.radius;c=c+this.radius/5){b.moveTo(Math.round(c),this.centery-3);b.lineTo(Math.round(c),this.centery+3.5)}for(c=this.centery-this.radius;c<this.centery+this.radius;c=c+this.radius/5){b.moveTo(this.centerx-3,Math.round(c));b.lineTo(this.centerx+3,Math.round(c))}b.moveTo(Math.round(this.centerx),this.centery-
this.radius);b.lineTo(Math.round(this.centerx),this.centery+this.radius);b.moveTo(this.centerx-5,Math.round(this.centery-this.radius));b.lineTo(this.centerx+5,Math.round(this.centery-this.radius));b.moveTo(this.centerx-5,Math.round(this.centery+this.radius));b.lineTo(this.centerx+5,Math.round(this.centery+this.radius));b.closePath();b.stroke()}};this.DrawRose=function(){var c=0,d=this.data,f=RGraph.degrees2Radians(a["chart.margin"]);if(l.is_null(a["chart.ymax"])){for(var e=0;e<d.length;++e)c=typeof d[e]==
"number"?Math.max(c,d[e]):typeof d[e]=="object"&&a["chart.variant"]=="non-equi-angular"?Math.max(c,d[e][0]):Math.max(c,l.array_sum(d[e]));this.scale2=l.getScale2(this,{max:c,min:0,"scale.thousand":a["chart.scale.thousand"],"scale.point":a["chart.scale.point"],"scale.decimals":a["chart.scale.decimals"],"ylabels.count":a["chart.labels.count"],"scale.round":a["chart.scale.round"],"units.pre":a["chart.units.pre"],"units.post":a["chart.units.post"]})}else this.scale2=l.getScale2(this,{max:a["chart.ymax"],
strict:true,"scale.thousand":a["chart.scale.thousand"],"scale.point":a["chart.scale.point"],"scale.decimals":a["chart.scale.decimals"],"ylabels.count":a["chart.labels.count"],"scale.round":a["chart.scale.round"],"units.pre":a["chart.units.pre"],"units.post":a["chart.units.post"]});this.max=this.scale2.max;this.sum=l.array_sum(d);b.moveTo(this.centerx,this.centery);b.stroke();if(a["chart.colors.alpha"])b.globalAlpha=a["chart.colors.alpha"];if(typeof a["chart.variant"]=="string"&&a["chart.variant"]==
"non-equi-angular"){for(var h=0,e=0;e<d.length;++e)h=h+d[e][1];for(e=0;e<this.data.length;++e){var d=this.data[e][1]/h*TWOPI,j=(this.data[e][0]-a["chart.ymin"])/(this.max-a["chart.ymin"])*this.radius,j=j*a["chart.animation.grow.multiplier"];b.strokeStyle=a["chart.strokestyle"];b.fillStyle=a["chart.colors"][0];if(a["chart.colors.sequential"])b.fillStyle=a["chart.colors"][e];b.beginPath();var c=this.startRadians*a["chart.animation.roundrobin.factor"]-HALFPI+f,k=(this.startRadians+d)*a["chart.animation.roundrobin.factor"]-
HALFPI-f,i=this.getexploded(e,c,k,a["chart.exploded"]),g=i[0],i=i[1];b.arc(this.centerx+g,this.centery+i,a["chart.animation.roundrobin.radius"]?j*a["chart.animation.roundrobin.factor"]:j,c,k,0);b.lineTo(this.centerx+g,this.centery+i);b.closePath();b.stroke();b.fill();this.angles.push(gg=[c,k,0,j,this.centerx+g,this.centery+i]);this.startRadians=this.startRadians+d}}else for(var m=0,e=0;e<this.data.length;++e){b.strokeStyle=a["chart.strokestyle"];b.fillStyle=a["chart.colors"][0];if(a["chart.colors.sequential"])b.fillStyle=
a["chart.colors"][e];d=1/this.data.length*TWOPI;if(typeof this.data[e]=="number"){b.beginPath();j=(this.data[e]-a["chart.ymin"])/(this.max-a["chart.ymin"])*this.radius;j=j*a["chart.animation.grow.multiplier"];c=this.startRadians*a["chart.animation.roundrobin.factor"]-HALFPI+f;k=this.startRadians*a["chart.animation.roundrobin.factor"]+d*a["chart.animation.roundrobin.factor"]-HALFPI-f;i=this.getexploded(e,c,k,a["chart.exploded"]);g=i[0];i=i[1];b.arc(this.centerx+g,this.centery+i,a["chart.animation.roundrobin.radius"]?
j*a["chart.animation.roundrobin.factor"]:j,c,k,0);b.lineTo(this.centerx+g,this.centery+i);b.closePath();b.stroke();b.fill();this.angles.push([c,k,0,j*a["chart.animation.roundrobin.factor"],this.centerx+g,this.centery+i])}else if(typeof this.data[e]=="object"){f=a["chart.margin"]/(180/PI);this.angles2[e]||(this.angles2[e]=[]);for(j=0;j<this.data[e].length;++j){c=this.startRadians*a["chart.animation.roundrobin.factor"]-HALFPI+f;k=this.startRadians*a["chart.animation.roundrobin.factor"]+d*a["chart.animation.roundrobin.factor"]-
HALFPI-f;i=this.getexploded(e,c,k,a["chart.exploded"]);g=i[0];i=i[1];b.fillStyle=a["chart.colors"][j];if(a["chart.colors.sequential"])b.fillStyle=a["chart.colors"][m++];if(j==0){b.beginPath();var n=0,h=(this.data[e][j]-a["chart.ymin"])/(this.max-a["chart.ymin"])*this.radius,h=h*a["chart.animation.grow.multiplier"];b.arc(this.centerx+g,this.centery+i,a["chart.animation.roundrobin.radius"]?h*a["chart.animation.roundrobin.factor"]:h,c,k,0);b.lineTo(this.centerx+g,this.centery+i);b.closePath();b.stroke();
b.fill();this.angles.push([c,k,0,h*a["chart.animation.roundrobin.factor"],this.centerx+g,this.centery+i]);this.angles2[e].push([c,k,0,h*a["chart.animation.roundrobin.factor"],this.centerx+g,this.centery+i])}else{b.beginPath();n=h;h=(this.data[e][j]-a["chart.ymin"])/(this.max-a["chart.ymin"])*this.radius+n;h=h*a["chart.animation.grow.multiplier"];b.arc(this.centerx+g,this.centery+i,n*a["chart.animation.roundrobin.factor"],c,k,0);b.arc(this.centerx+g,this.centery+i,h*a["chart.animation.roundrobin.factor"],
k,c,true);b.closePath();b.stroke();b.fill();this.angles.push([c,k,n*a["chart.animation.roundrobin.factor"],h*a["chart.animation.roundrobin.factor"],this.centerx+g,this.centery+i]);this.angles2[e].push([c,k,n*a["chart.animation.roundrobin.factor"],h*a["chart.animation.roundrobin.factor"],this.centerx+g,this.centery+i])}}}this.startRadians=this.startRadians+d}if(a["chart.colors.alpha"])b.globalAlpha=1;a["chart.title"]&&l.DrawTitle(this,a["chart.title"],o.height/2-this.radius,this.centerx,a["chart.title.size"]?
a["chart.title.size"]:a["chart.text.size"]+2)};this.DrawLabels=function(){b.lineWidth=1;var c=a["chart.key"];c&&c.length&&l.DrawKey(this,c,a["chart.colors"]);b.fillStyle=a["chart.text.color"];b.strokeStyle="black";var c=this.radius,d=a["chart.text.font"],f=a["chart.text.size"],e=a["chart.labels.axes"].toLowerCase(),h=a["chart.units.pre"],j=a["chart.units.post"],k=this.centerx,i=this.centery;typeof a["chart.labels"]=="object"&&a["chart.labels"]&&this.DrawCircularLabels(b,a["chart.labels"],d,f,c+10);
typeof a["chart.text.size.scale"]=="number"&&(f=a["chart.text.size.scale"]);if(e.indexOf("n")>-1)for(var g=0;g<a["chart.labels.count"];++g)l.Text2(this,{font:d,size:f,x:k,y:i-c*((g+1)/a["chart.labels.count"]),text:this.scale2.labels[g],valign:"center",halign:"center",bounding:true,boundingFill:"rgba(255,255,255,0.8)",tag:"scale"});if(e.indexOf("s")>-1)for(g=0;g<a["chart.labels.count"];++g)l.Text2(this,{font:d,size:f,x:k,y:i+c*((g+1)/a["chart.labels.count"]),text:this.scale2.labels[g],valign:"center",
halign:"center",bounding:true,boundingFill:"rgba(255,255,255,0.8)",tag:"scale"});if(e.indexOf("e")>-1)for(g=0;g<a["chart.labels.count"];++g)l.Text2(this,{font:d,size:f,x:k+c*((g+1)/a["chart.labels.count"]),y:i,text:this.scale2.labels[g],valign:"center",halign:"center",bounding:true,boundingFill:"rgba(255,255,255,0.8)",tag:"scale"});if(e.indexOf("w")>-1)for(g=0;g<a["chart.labels.count"];++g)l.Text2(this,{font:d,size:f,x:k-c*((g+1)/a["chart.labels.count"]),y:i,text:this.scale2.labels[g],valign:"center",
halign:"center",bounding:true,boundingFill:"rgba(255,255,255,0.8)",tag:"scale"});e.length>0&&l.Text2(this,{font:d,size:f,x:k,y:i,text:typeof a["chart.ymin"]=="number"?l.number_format(this,Number(a["chart.ymin"]).toFixed(a["chart.scale.decimals"]),h,j):"0",valign:"center",halign:"center",bounding:true,boundingFill:"rgba(255,255,255,0.8)",tag:"scale"})};this.DrawCircularLabels=function(c,d,b,e,h){for(var c=a["chart.variant"],h=h+5+a["chart.labels.offset"],j=this.centerx,k=this.centery,i=0;i<d.length;++i){if(typeof c==
"string"&&c=="non-equi-angular")var g=Number(this.angles[i][0])+(this.angles[i][1]-this.angles[i][0])/2;else{g=TWOPI/d.length*(i+1)-TWOPI/(d.length*2);g=g-HALFPI+(a["chart.labels.position"]=="edge"?TWOPI/d.length/2:0)}var m=j+Math.cos(g)*h,g=k+Math.sin(g)*h;halign=m>j?"left":Math.round(m)==j?"center":"right";l.Text2(this,{font:b,size:e,x:m,y:g,text:String(d[i]),halign:halign,valign:"center",tag:"labels"})}};this.getShape=this.getSegment=function(c){l.FixEventObject(c);for(var d=this.angles,f=0;f<
d.length;++f){var e=d[f][0],h=d[f][1],j=d[f][2],k=d[f][3],i=d[f][4],g=d[f][5],m=l.getMouseXY(c);b.beginPath();b.arc(i,g,j?j:0.01,e,h,false);b.arc(i,g,k,h,e,true);b.closePath();if(b.isPointInPath(m[0],m[1])){d[f][6]=f;if(l.parseTooltipText)var n=l.parseTooltipText(a["chart.tooltips"],d[f][6]);d[f].object=this;d[f].x=d[f][4];d[f].y=d[f][5];d[f]["angle.start"]=d[f][0];d[f]["angle.end"]=d[f][1];d[f]["radius.start"]=d[f][2];d[f]["radius.end"]=d[f][3];d[f].index=d[f][6];d[f].tooltip=n?n:null;return d[f]}}return null};
this.getexploded=function(a,b,f,e){var h;if(typeof e=="object"&&typeof e[a]=="number"){h=Math.cos((f-b)/2+b)*e[a];a=Math.sin((f-b)/2+b)*e[a]}else if(typeof e=="number"){h=Math.cos((f-b)/2+b)*e;a=Math.sin((f-b)/2+b)*e}else a=h=0;return[h,a]};this.AllowTooltips=function(){l.PreLoadTooltipImages(this);l.InstallWindowMousedownTooltipListener(this);l.InstallCanvasMousemoveTooltipListener(this);l.InstallCanvasMouseupTooltipListener(this)};this.Highlight=function(c){if(a["chart.tooltips.highlight"]){b.beginPath();
b.strokeStyle=a["chart.highlight.stroke"];b.fillStyle=a["chart.highlight.fill"];b.arc(c.x,c.y,c["radius.end"],c["angle.start"],c["angle.end"],false);c["radius.start"]>0?b.arc(c.x,c.y,c["radius.start"],c["angle.end"],c["angle.start"],true):b.lineTo(c.x,c.y);b.closePath();b.stroke();b.fill()}};this.getObjectByXY=function(a){var a=RGraph.getMouseXY(a),b=l.getHypLength(this.centerx,this.centery,a[0],a[1]);if(a[0]>this.centerx-this.radius&&a[0]<this.centerx+this.radius&&a[1]>this.centery-this.radius&&
a[1]<this.centery+this.radius&&b<=this.radius)return this};this.positionTooltip=function(a,b,f,e,h){var b=a.angles[h][4],f=a.angles[h][5],j=a.angles[h][0],k=(a.angles[h][3]-a.angles[h][2])/2+a.angles[h][2],h=(a.angles[h][1]-j)/2+j,a=l.getCanvasXY(a.canvas),j=e.offsetWidth,i=e.offsetHeight;e.style.overflow="";var g=new Image;g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAFCAYAAACjKgd3AAAARUlEQVQYV2NkQAN79+797+RkhC4M5+/bd47B2dmZEVkBCgcmgcsgbAaA9GA1BCSBbhAuA/AagmwQPgMIGgIzCD0M0AMMAEFVIAa6UQgcAAAAAElFTkSuQmCC";
g.style.position="absolute";g.id="__rgraph_tooltip_pointer__";g.style.top=e.offsetHeight-2+"px";e.appendChild(g);if(a[0]+b+Math.cos(h)*k-j/2<10){e.style.left=a[0]+b+Math.cos(h)*k-j*0.1+"px";e.style.top=a[1]+f+Math.sin(h)*k-i-5+"px";g.style.left=j*0.1-8.5+"px"}else if(a[0]+b+Math.cos(h)*k+j/2>document.body.offsetWidth-10){e.style.left=a[0]+b+Math.cos(h)*k-j*0.9+"px";e.style.top=a[1]+f+Math.sin(h)*k-i-5+"px";g.style.left=j*0.9-8.5+"px"}else{e.style.left=a[0]+b+Math.cos(h)*k-j/2+"px";e.style.top=a[1]+
f+Math.sin(h)*k-i-5+"px";g.style.left=j*0.5-8.5+"px"}};this.getRadius=function(a){return a<0||a>this.max?null:a/this.max*this.radius};this.parseColors=function(){for(var b=0;b<a["chart.colors"].length;++b)a["chart.colors"][b]=this.parseSingleColorForGradient(a["chart.colors"][b]);if(!l.is_null(a["chart.key.colors"]))for(b=0;b<a["chart.key.colors"].length;++b)a["chart.key.colors"][b]=this.parseSingleColorForGradient(a["chart.key.colors"][b]);a["chart.text.color"]=this.parseSingleColorForGradient(a["chart.text.color"]);
a["chart.title.color"]=this.parseSingleColorForGradient(a["chart.title.color"]);a["chart.highlight.fill"]=this.parseSingleColorForGradient(a["chart.highlight.fill"]);a["chart.highlight.stroke"]=this.parseSingleColorForGradient(a["chart.highlight.stroke"])};this.parseSingleColorForGradient=function(a){if(!a||typeof a!="string")return a;if(a.match(/^gradient\((.*)\)$/i)){var d=RegExp.$1.split(":"),f=b.createRadialGradient(this.centerx,this.centery,0,this.centerx,this.centery,this.radius),e=1/(d.length-
1);f.addColorStop(0,l.trim(d[0]));for(var h=1;h<d.length;++h)f.addColorStop(h*e,l.trim(d[h]))}return f?f:a};this.interactiveKeyHighlight=function(c){this.angles2.forEach(function(d){if(d=d[c]){b.beginPath();b.lineWidth=2;b.fillStyle=a["chart.key.interactive.highlight.chart.fill"];b.strokeStyle=a["chart.key.interactive.highlight.chart.stroke"];b.arc(d[4],d[5],d[2],d[0],d[1],false);b.arc(d[4],d[5],d[3],d[1],d[0],true);b.closePath();b.fill();b.stroke()}})};l.Register(this)};
