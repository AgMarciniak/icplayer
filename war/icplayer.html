<!doctype html>

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <title>Runtime test</title>
    
    <script type="text/javascript" language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" language="javascript" src="icplayer/icplayer.nocache.js"></script>
    
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
        TeX: {
            imageFont: null,
            extensions: ["mhchem.js"]
        }
    });
    </script>    
    <script language="javascript">
		var player;
      	function icOnAppLoaded(){
	        // Load assessment
    	    player = icCreatePlayer('_icplayer');
	        player.load('test/pages/main.xml');
	       	//player1.load('content/default.ic.xml');
        	player.onStatusChanged(function(type, source, value){
        		//console.log("type:" + type + ", source: " + source, ", value:" + value);
        	});
      	}
      	
      	function testPlayerService(){
      		var ps = player.getPlayerServices();
      		var model = ps.getPresentation();
      		var scoreService = ps.getScore();
      		var sumOfScore = 0.0;
      		var count = 0;
      		for(var i = 0; i < model.getPageCount(); i++){
      			var page = model.getPage(i);
      			if(page.isReportable()){
      				count += 1;
      				var score = scoreService.getPageScore(page.getName());
      				var percentageScore = (score['score']*100.0)/score['maxScore']
      				sumOfScore += percentageScore; 
      			}
      		}
      		
      		var lessonScore = sumOfScore/count;
      		console.log("Lesson score: " + lessonScore);
      	}
      
      	
      	var state;
      	function getPlayerState(){
      		if(typeof(Storage)=="undefined"){
      			alert('Local storage not implemented')
			}
      		else{
      			localStorage.state = player1.getState();
	      		console.log(state);
      		}
      	}
      
      	
      	function setPlayerState(){
      		if(localStorage.state){
      			player.setState(localStorage.state);
      		}
      	}
    </script>
    
    <script type="text/javascript"
  		src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
    
  </head>

  <body>
	<div id="_icplayer"></div>
	<button onClick="testPlayerService()">Test Service</button>
	<button onClick="getPlayerState()">Save player state</button>
	<button onClick="setPlayerState()">Load player state</button>

  </body>
</html>

